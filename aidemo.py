# mock_ai.py

import time
from utils import logger

# 预定义的对话内容
dialogue1 = [
    {
        
        "content": "**欢迎并引导:**\n- 请先热情欢迎新员工，自我介绍，并引导他们到指定区域开始办理入职。\n\n**核实并收集资料:**\n- 请确认新员工携带了所有需要的文件，包括身份证、学历证明、体检报告和离职证明（如适用）。\n- 准备收集这些文件的复印件或电子版。\n\n**填写表格提醒:**\n- 待文件核对后，将指导新员工填写《员工履历表》与《岗位申请表》，确保信息无误。\n\n**接下来是合同签署:**\n- 准备好劳动合同，稍后将解释合同条款并安排签署。\n\n如有流程不清晰，请查阅右侧参考文档。"
    },
    {
        
        "content": "**收集资料:**\n- 请收集新员工的身份证正反面复印件进行身份验证。\n- 收取最高学历及学位证书复印件，确认教育背景。\n- 确保获取近期体检报告复印件，检查健康状况。\n- 如果适用，收集离职证明复印件。\n- 不要忘记询问并收取专业资格证书扫描件（如适用）。\n\n**紧急联系与银行信息:**\n- 之后，记录新员工提供的紧急联系人信息和个人银行账户详情，以处理薪资发放事宜。\n- 如公司政策涉及，也请收集公积金账号信息。\n\n开始执行并告诉我完成这些步骤的情况。"
    },
    {
        
        "content": "**资料收集进度确认:**\n- 已收到身份证、学位证、离职证明的文件，了解体检报告将后续补充。\n\n**紧急联系人信息确认:**\n- 紧急联系人：张三，关系：母亲，电话：13311001100。已记录。\n\n**银行账户信息确认:**\n- 银行：中国银行，账号：4411229988443311。已登记。\n\n**公积金账户说明:**\n- 新员工目前未建立公积金账户，此信息可在未来补全。\n\n接下来，请指导新员工填写《员工履历表》和《岗位申请表》，确保所有信息准确无误。完成后，请通知我，以便进行合同签署的准备。"
    }
]

dialogue2 = [
    {
        "content": """尊敬的东方建设集团，根据您的资质与偏好，我们为您找到了最近3日内符合要求的15条招标公告，具体如下：<table border="1"><tr><th>招标编号</th><th>项目名称</th><th>地区</th><th>项目规模</th><th>招标价格</th><th>截止日期</th></tr><tr><td>B001</td><td>堡油路养护维修工程</td><td>浙江</td><td>大型</td><td>20000000</td><td>2023/4/10</td></tr><tr><td>B002</td><td>鹤立西路（林海公路-沪南公路）改建工程</td><td>江苏</td><td>中型</td><td>15000000</td><td>2023/4/12</td></tr><tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><td>B015</td><td>黄浦江中上游堤防防洪能力提升工程（二期）</td><td>上海</td><td>大型</td><td>30000000</td><td>2023/4/15</td></tr>
</table> <br> 以上项目均要求一级资质，且覆盖道路工程或桥梁建设领域，与您的主营业务范围完美匹配。请您及时查阅详细信息并考虑参与投标。祝您投标成功"""
    }
]

dialogue3 = [
    {
        "content": """<strong>尊敬的用户，以下是荔湾区近期的部分新项目信息：</strong><br><ul><li>荔湾区葵蓬南住房项目基坑支护工程设计施工总承包SL202404300060-20240430214021.GZZB2024-04-30<ul><li>日期：2024-04-30</li><li>类型：工程建设信息类型：招标/资审公告</li><li>行业：房屋建筑业</li></ul></li><li>荔湾区公安分局档案中心大楼改造工程最近公告日期为2024-04-29<ul><li>类型：交易结果公示</li><li>行业：房屋建筑业</li></ul></li><li>荔湾区委党校建设工程勘察设计最近公告日期为2024-04-29<ul><li>类型：开标记录</li><li>行业：房屋建筑业</li></ul></li></ul>以上项目均位于广东荔湾区，涵盖了房屋建筑业等多个领域，包括设计施工、改造工程等。更多详情请访问广东的工程建设信息平台。持续关注，以获取最新进展。\n\n"""
    }
]

# 预定义的日志内容
log_messages1 = [
    "🤓：正在理解用户意图，用户询问新员工入职流程的下一步行动，表明需要一个详细的入职引导流程。\n 🫡：正在调用资源，启用入职管理机器人\n🤖入职管理：正在识别需要关于新员工入职流程的具体指导，启动知识库查询并规划响应框架\n 🤖入职管理：正在确定思路，1.资料核验与收集，2.行政手续指导，3.合同签署准备<br>😊：正在生成回答",
    "2",
    "2"
]
log_messages2 = [
    # "**问题解析机器人**：\n- 正在识别用户意图：用户想要了解近期符合其资质和偏好的招标公告。\n- 正在提取用户数据：从用户偏好配置表中获取U001的详细信息，包括资质等级（一级）、主营业务范围（道路工程,桥梁建设）、地区偏好（上海,江苏,浙江）、项目规模偏好（大型,中型）、预算范围（10000000-50000000）等。\n- 正在确定筛选条件：依据提取的用户数据，设置筛选招标公告的条件，包括时间（最近）、资质、业务范围、地区、规模、预算等。\n\n**招标数据机器人**：\n- 正在查询数据库：根据上述条件，在招标公告数据库中搜索匹配项。\n- 正在数据分析：发现近3日内共有15条招标公告符合要求，其中10条位于浙江，3条在江苏，2条在上海，全部属于道路工程或桥梁建设项目，均要求一级资质，项目规模和预算范围也与用户偏好相符。\n- 准备数据输出：整理这15条招标公告的关键信息，包括招标编号、项目名称、地区、项目规模、预算、截止日期等，准备传递给回答机器人。\n\n**回答机器人**：\n- 正在组织信息：将招标数据整理成易于阅读的格式，如表格，确保包含用户最关心的信息点。\n- 准备个性化回复：根据整理的信息，形成友好且专业的回答，强调匹配度高和关键时间点，以便用户快速决策。"
    "<strong>问题解析机器人：</strong><br><ul><li>正在识别用户意图：用户想要了解近期符合其资质和偏好的招标公告。</li><li>正在提取用户数据：从用户偏好配置表中获取U001的详细信息，包括资质等级（一级）、主营业务范围（道路工程,桥梁建设）、地区偏好（上海,江苏,浙江）、项目规模偏好（大型,中型）、预算范围（10000000-50000000）等。</li><li>正在确定筛选条件：依据提取的用户数据，设置筛选招标公告的条件，包括时间（最近）、资质、业务范围、地区、规模、预算等。</li></ul><br><strong>招标数据机器人：</strong><br><ul><li>正在查询数据库：根据上述条件，在招标公告数据库中搜索匹配项。</li><li>正在数据分析：发现近3日内共有15条招标公告符合要求，其中10条位于浙江，3条在江苏，2条在上海，全部属于道路工程或桥梁建设项目，均要求一级资质，项目规模和预算范围也与用户偏好相符。</li><li>准备数据输出：整理这15条招标公告的关键信息，包括招标编号、项目名称、地区、项目规模、预算、截止日期等，准备传递给回答机器人。</li></ul><br><strong>回答机器人：</strong><br><ul><li>正在组织信息：将招标数据整理成易于阅读的格式，如表格，确保包含用户最关心的信息点。</li><li>准备个性化回复：根据整理的信息，形成友好且专业的回答，强调匹配度高和关键时间点，以便用户快速决策。</li></ul>"
]
log_messages3 = [
     "🤓：正在理解用户意图，用户询问“荔湾区有什么新项目？”意味着他们对荔湾区内的最新工程项目信息感兴趣，尤其是那些可能还未开始或正在进行中的项目\n 🫡：正在细化查询条件，基于用户问题，需要从数据库中筛选出荔湾区的项目，且倾向于关注最新的招标公告、设计施工总承包等信息类型，启用招标数据机器人\n 🤖招标数据：正在构建查询指令，将关键词限定为荔湾区，信息类型聚焦于招标公告、开标记录、设计施工总承包等，同时考虑时间因素，优先选取最近的记录\n 🤖招标数据：从数据库中获取到了多个与荔湾区相关的项目记录，包括基坑支护工程设计施工总承包、公安分局档案中心大楼改造工程、区委党校建设工程勘察设计等，注意区分不同信息类型的记录日期，确保提供的是最新且未过期的信息\n 🤖招标数据：正在确认这些项目的时间范围符合“新项目”的定义，多数集中在2024年4月\n 😊：正在组织回复内容，并提供进一步行动建议，如查看具体公告或联系相关平台，以及关注后续可能的更新",
    "2",
    "3"
]

# 用于记录日志进度的索引
log_index = 0

# 用于记录对话进度的索引
dialogue_index = 0

import re
def apply_style(message):
    # 定义样式，淡灰色背景与深灰色字体
      # 定义样式，淡灰色背景与深灰色字体
    style_prefix = "<div style='background-color: var(--lisy); width:90%;color: var(--text);padding: 2px; border-radius: 4px;'>"
    style_suffix = "</div>"
    return f"{style_prefix}{message}{style_suffix}"

def get_ai_response(user_input):
    global log_index, dialogue_index, log_messages3, dialogue3

     # 生成预定义的日志信息
    if log_index < len(log_messages3):
        
        log_message = log_messages3[log_index]
        # 使用换行符分割log_message
        parts = re.split('<br>|\n', log_message)
        for part in parts:
            styled_part = apply_style(part)
            logger.info(styled_part)
            time.sleep(2)  # 模拟每个部分发送后等待3秒
            print("wait 2s")
        log_index += 1  # 增加日志索引以记录下一个日志信息
    else:
        logger.info("Logger: 未定义的日志信息。")

    # 确保日志输出完成后再输出dialogue
    full_response = ""
    if dialogue_index < len(dialogue3):
        response = dialogue3[dialogue_index]
        dialogue_index += 1
        full_response = f" {response['content']}"
    else:
        full_response = "已准备的demo结束。"

    # 模拟逐字符输出并将其组合成一个字符串返回
    simulated_typing = ""
    for char in full_response:
        simulated_typing += char
        time.sleep(0.005)  # 模拟逐字符输出的延迟

    # 在函数调用的最后添加一个显式的等待时间，确保每次调用之间有等待间隔
    # time.sleep(3)  # 在每次消息发送完毕后等待3秒
    # print("wait 3s")

    return simulated_typing